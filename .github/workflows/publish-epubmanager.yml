name: Publish EpubManager NuGet Package

on:
  push:
    branches:
      - main

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Setup .NET
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.x'

      # Extract version from .csproj
      - name: Get version
        id: get-version
        run: |
          VERSION=$(xmllint --xpath "string(//Project/PropertyGroup/Version)" ./BookHeaven.EpubManager.csproj)
          echo "EpubManager version: $VERSION"
          echo "VERSION=$VERSION" >> $GITHUB_ENV

      # Publish EpubManager package
      - name: Publish NuGet package
        run: |
          dotnet pack ./BookHeaven.EpubManager.csproj --configuration Release --output ./packages
          dotnet nuget push ./packages/BookHeaven.EpubManager.$VERSION.nupkg \
            --source "github" \
            --api-key ${{ secrets.GITHUB_TOKEN }}
